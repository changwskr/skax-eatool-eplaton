<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">초기 데이터 생성 - MBB Java</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .form-section { background: #f8f9fa; padding: 2rem; border-radius: 10px; margin-bottom: 2rem; }
        .preview-section { background: #fff; padding: 2rem; border-radius: 10px; border: 1px solid #dee2e6; }
        .code-preview { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 1rem; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/mbb/">MBB Java</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/">홈</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/entity-generator">Entity 생성</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/data-generator">데이터 생성</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/api-test">API 테스트</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-2">초기 데이터 생성</h1>
                <p class="lead mb-0">초기 기초 데이터 자동 Insert 스크립트를 생성합니다.</p>
            </div>
            <a href="/mbb/" class="btn btn-outline-primary">
                <i class="fas fa-home"></i> 홈으로
            </a>
        </div>

        <!-- Data Generation Form -->
        <div class="form-section">
            <h3 class="mb-3">데이터 설정</h3>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="entityName" class="form-label">Entity 클래스명</label>
                    <input type="text" class="form-control" id="entityName" placeholder="예: Mbbuser, Product, Order">
                </div>
                <div class="col-md-6">
                    <label for="tableName" class="form-label">테이블명</label>
                    <input type="text" class="form-control" id="tableName" placeholder="예: users, products, orders">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="dataCount" class="form-label">생성할 데이터 개수</label>
                    <input type="number" class="form-control" id="dataCount" value="10" min="1" max="1000">
                </div>
                <div class="col-md-6">
                    <label for="dataType" class="form-label">데이터 타입</label>
                    <select class="form-select" id="dataType">
                        <option value="sample">샘플 데이터</option>
                        <option value="random">랜덤 데이터</option>
                        <option value="faker">Faker 라이브러리</option>
                    </select>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">데이터 옵션</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeId" checked>
                    <label class="form-check-label" for="includeId">
                        ID 포함
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="includeTimestamp" checked>
                    <label class="form-check-label" for="includeTimestamp">
                        생성/수정 시간 포함
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="generateSql" checked>
                    <label class="form-check-label" for="generateSql">
                        SQL INSERT 문 생성
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="generateJson" checked>
                    <label class="form-check-label" for="generateJson">
                        JSON 데이터 생성
                    </label>
                </div>
            </div>

            <button type="button" class="btn btn-primary" onclick="generateData()">
                <i class="fas fa-code"></i> 데이터 생성
            </button>
        </div>

        <!-- Generated Code Preview -->
        <div class="preview-section">
            <h3 class="mb-3">생성된 데이터</h3>
            <div class="code-preview">
                <pre id="dataCode">데이터 설정을 입력하고 생성 버튼을 클릭하세요.</pre>
            </div>
            <div class="mt-3">
                <button type="button" class="btn btn-secondary" onclick="copyCode()">
                    <i class="fas fa-copy"></i> 코드 복사
                </button>
                <button type="button" class="btn btn-success" onclick="downloadCode()">
                    <i class="fas fa-download"></i> 파일 다운로드
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function generateData() {
            const entityName = document.getElementById('entityName').value;
            const tableName = document.getElementById('tableName').value;
            const dataCount = parseInt(document.getElementById('dataCount').value);
            const dataType = document.getElementById('dataType').value;
            const includeId = document.getElementById('includeId').checked;
            const includeTimestamp = document.getElementById('includeTimestamp').checked;
            const generateSql = document.getElementById('generateSql').checked;
            const generateJson = document.getElementById('generateJson').checked;

            if (!entityName || !tableName) {
                alert('모든 필수 필드를 입력해주세요.');
                return;
            }

            let dataCode = `-- ${entityName} 초기 데이터 생성 스크립트

-- SQL INSERT 문
INSERT INTO ${tableName} (name, email, phone, age, created_at, updated_at) VALUES
('홍길동', 'hong@example.com', '010-1234-5678', 30, NOW(), NOW()),
('김철수', 'kim@example.com', '010-2345-6789', 25, NOW(), NOW()),
('이영희', 'lee@example.com', '010-3456-7890', 28, NOW(), NOW()),
('박민수', 'park@example.com', '010-4567-8901', 35, NOW(), NOW()),
('정수진', 'jung@example.com', '010-5678-9012', 27, NOW(), NOW()),
('최영호', 'choi@example.com', '010-6789-0123', 32, NOW(), NOW()),
('윤미영', 'yoon@example.com', '010-7890-1234', 29, NOW(), NOW()),
('강동원', 'kang@example.com', '010-8901-2345', 31, NOW(), NOW()),
('임지영', 'lim@example.com', '010-9012-3456', 26, NOW(), NOW()),
('한승우', 'han@example.com', '010-0123-4567', 33, NOW(), NOW());

-- JSON 데이터
[
  {
    "id": 1,
    "name": "홍길동",
    "email": "hong@example.com",
    "phone": "010-1234-5678",
    "age": 30,
    "createdAt": "2024-01-01T00:00:00",
    "updatedAt": "2024-01-01T00:00:00"
  },
  {
    "id": 2,
    "name": "김철수",
    "email": "kim@example.com",
    "phone": "010-2345-6789",
    "age": 25,
    "createdAt": "2024-01-01T00:00:00",
    "updatedAt": "2024-01-01T00:00:00"
  },
  {
    "id": 3,
    "name": "이영희",
    "email": "lee@example.com",
    "phone": "010-3456-7890",
    "age": 28,
    "createdAt": "2024-01-01T00:00:00",
    "updatedAt": "2024-01-01T00:00:00"
  }
]

-- Java 코드 (DataLoader)
@Component
public class ${entityName}DataLoader implements CommandLineRunner {
    
    @Autowired
    private ${entityName}Repository ${entityName.toLowerCase()}Repository;
    
    @Override
    public void run(String... args) throws Exception {
        if (${entityName.toLowerCase()}Repository.count() == 0) {
            List<${entityName}> ${entityName.toLowerCase()}s = Arrays.asList(
                new ${entityName}("홍길동", "hong@example.com", "010-1234-5678", 30),
                new ${entityName}("김철수", "kim@example.com", "010-2345-6789", 25),
                new ${entityName}("이영희", "lee@example.com", "010-3456-7890", 28)
            );
            ${entityName.toLowerCase()}Repository.saveAll(${entityName.toLowerCase()}s);
        }
    }
}`;

            document.getElementById('dataCode').textContent = dataCode;
        }

        function copyCode() {
            const codeText = document.getElementById('dataCode').textContent;
            navigator.clipboard.writeText(codeText).then(() => {
                alert('코드가 클립보드에 복사되었습니다.');
            });
        }

        function downloadCode() {
            const codeText = document.getElementById('dataCode').textContent;
            const tableName = document.getElementById('tableName').value || 'table';
            const blob = new Blob([codeText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${tableName}_data.sql`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html> 