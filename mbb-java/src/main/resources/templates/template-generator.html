<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">HTML 템플릿 생성 - MBB Java</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .form-section { background: #f8f9fa; padding: 2rem; border-radius: 10px; margin-bottom: 2rem; }
        .preview-section { background: #fff; padding: 2rem; border-radius: 10px; border: 1px solid #dee2e6; }
        .code-preview { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 1rem; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/mbb/">MBB Java</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/">홈</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/entity-generator">Entity 생성</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/template-generator">템플릿 생성</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/api-test">API 테스트</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-2">HTML 템플릿 생성</h1>
                <p class="lead mb-0">Thymeleaf 기반의 웹 페이지 템플릿을 생성합니다.</p>
            </div>
            <a href="/mbb/" class="btn btn-outline-primary">
                <i class="fas fa-home"></i> 홈으로
            </a>
        </div>

        <!-- Template Generation Form -->
        <div class="form-section">
            <h3 class="mb-3">템플릿 설정</h3>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="entityName" class="form-label">Entity 클래스명</label>
                    <input type="text" class="form-control" id="entityName" placeholder="예: Mbbuser, Product, Order">
                </div>
                <div class="col-md-6">
                    <label for="templateName" class="form-label">템플릿명</label>
                    <input type="text" class="form-control" id="templateName" placeholder="예: user-list, product-detail">
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">생성할 템플릿 타입</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="listTemplate" checked>
                    <label class="form-check-label" for="listTemplate">
                        목록 페이지 (List)
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="detailTemplate" checked>
                    <label class="form-check-label" for="detailTemplate">
                        상세 페이지 (Detail)
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="formTemplate" checked>
                    <label class="form-check-label" for="formTemplate">
                        입력/수정 폼 (Form)
                    </label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">템플릿 기능</label>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="bootstrap" checked>
                    <label class="form-check-label" for="bootstrap">
                        Bootstrap 스타일링
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="pagination" checked>
                    <label class="form-check-label" for="pagination">
                        페이징 기능
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="search" checked>
                    <label class="form-check-label" for="search">
                        검색 기능
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="validation" checked>
                    <label class="form-check-label" for="validation">
                        클라이언트 검증
                    </label>
                </div>
            </div>

            <button type="button" class="btn btn-primary" onclick="generateTemplates()">
                <i class="fas fa-code"></i> 템플릿 생성
            </button>
        </div>

        <!-- Generated Code Preview -->
        <div class="preview-section">
            <h3 class="mb-3">생성된 HTML 템플릿</h3>
            <div class="code-preview">
                <pre id="templateCode">템플릿 설정을 입력하고 생성 버튼을 클릭하세요.</pre>
            </div>
            <div class="mt-3">
                <button type="button" class="btn btn-secondary" onclick="copyCode()">
                    <i class="fas fa-copy"></i> 코드 복사
                </button>
                <button type="button" class="btn btn-success" onclick="downloadCode()">
                    <i class="fas fa-download"></i> 파일 다운로드
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function generateTemplates() {
            const entityName = document.getElementById('entityName').value;
            const templateName = document.getElementById('templateName').value;
            const listTemplate = document.getElementById('listTemplate').checked;
            const detailTemplate = document.getElementById('detailTemplate').checked;
            const formTemplate = document.getElementById('formTemplate').checked;
            const bootstrap = document.getElementById('bootstrap').checked;
            const pagination = document.getElementById('pagination').checked;
            const search = document.getElementById('search').checked;
            const validation = document.getElementById('validation').checked;

            if (!entityName || !templateName) {
                alert('모든 필수 필드를 입력해주세요.');
                return;
            }

            let templateCode = `<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="\${title}">${entityName} 관리</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">${entityName} 관리 시스템</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/${templateName}/list">목록</a>
                <a class="nav-link" href="/${templateName}/create">등록</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>${entityName} 목록</h1>
            <a href="/${templateName}/create" class="btn btn-primary">
                <i class="fas fa-plus"></i> 새로 만들기
            </a>
        </div>

        <!-- 검색 폼 -->
        <div class="card mb-4">
            <div class="card-body">
                <form th:action="@{/${templateName}/search}" method="get" class="row g-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" name="keyword" placeholder="검색어를 입력하세요">
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-outline-primary w-100">검색</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 목록 테이블 -->
        <div class="card">
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>이름</th>
                            <th>이메일</th>
                            <th>생성일</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="${templateName} : \${${templateName}List}">
                            <td th:text="\${${templateName}.id}">1</td>
                            <td th:text="\${${templateName}.name}">홍길동</td>
                            <td th:text="\${${templateName}.email}">hong@example.com</td>
                            <td th:text="\${#temporals.format(${templateName}.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01</td>
                            <td>
                                <a th:href="@{/${templateName}/{id}(id=\${${templateName}.id})}" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye"></i> 보기
                                </a>
                                <a th:href="@{/${templateName}/{id}/edit(id=\${${templateName}.id})}" class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-edit"></i> 수정
                                </a>
                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                        th:onclick="'delete${entityName}(' + \${${templateName}.id} + ')'">
                                    <i class="fas fa-trash"></i> 삭제
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- 페이징 -->
                <nav th:if="\${${templateName}Page.totalPages > 1}">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:classappend="\${${templateName}Page.first} ? 'disabled'">
                            <a class="page-link" th:href="@{/${templateName}/list(page=\${${templateName}Page.number - 1})}">이전</a>
                        </li>
                        <li class="page-item" th:each="pageNum : \${#numbers.sequence(0, ${templateName}Page.totalPages - 1)}"
                            th:classappend="\${pageNum == ${templateName}Page.number} ? 'active'">
                            <a class="page-link" th:href="@{/${templateName}/list(page=\${pageNum})}" th:text="\${pageNum + 1}">1</a>
                        </li>
                        <li class="page-item" th:classappend="\${${templateName}Page.last} ? 'disabled'">
                            <a class="page-link" th:href="@{/${templateName}/list(page=\${${templateName}Page.number + 1})}">다음</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function delete${entityName}(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                fetch('/${templateName}/' + id, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('삭제에 실패했습니다.');
                    }
                });
            }
        }
    </script>
</body>
</html>`;

            document.getElementById('templateCode').textContent = templateCode;
        }

        function copyCode() {
            const codeText = document.getElementById('templateCode').textContent;
            navigator.clipboard.writeText(codeText).then(() => {
                alert('코드가 클립보드에 복사되었습니다.');
            });
        }

        function downloadCode() {
            const codeText = document.getElementById('templateCode').textContent;
            const templateName = document.getElementById('templateName').value || 'template';
            const blob = new Blob([codeText], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${templateName}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html> 