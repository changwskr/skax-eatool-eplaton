<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTO 생성 - MBB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .main-content {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        .form-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
        }
        .result-card {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
        }
        .error-card {
            background: #f8f9fa;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">
                            <i class="fas fa-cube"></i> MBB
                        </h4>
                        <p class="text-white-50">DTO 생성 도구</p>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link text-white" href="/mbb/">
                                <i class="fas fa-home"></i> 홈으로
                            </a>
                        </li>
                    <li class="nav-item">
                            <a class="nav-link text-white" href="/mbb/table-definition">
                                <i class="fas fa-table"></i> 테이블 정의
                            </a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link text-white" href="/mbb/entity-generator">
                                <i class="fas fa-code"></i> Entity 생성
                            </a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link text-white active" href="/mbb/dto-generator">
                                <i class="fas fa-file-alt"></i> DTO 생성
                            </a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link text-white" href="/mbb/repository-generator">
                                <i class="fas fa-database"></i> Repository 생성
                            </a>
                    </li>
                </ul>
        </div>
    </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">DTO 생성</h1>
            <a href="/mbb/" class="btn btn-outline-primary">
                <i class="fas fa-home"></i> 홈으로
            </a>
        </div>

                <!-- DTO 생성 폼 -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card form-card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-file-alt"></i> DTO 생성 설정
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="dtoForm">
                                    <div class="row">
                                        <!-- 기본 패키지 정보 -->
                                        <div class="col-md-6 mb-3">
                                            <label for="basePackage" class="form-label">기본 패키지명</label>
                                            <input type="text" class="form-control" id="basePackage" name="basePackage" 
                                                   value="com.skax.eatool.mbb" required>
                                            <div class="form-text">예: com.skax.eatool.mbb</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="entityName" class="form-label">엔티티 클래스명</label>
                                            <input type="text" class="form-control" id="entityName" name="entityName" 
                                                   placeholder="예: User" required>
                                            <div class="form-text">파스칼케이스로 입력 (예: User, Product)</div>
                                        </div>
                                    </div>

                                    <hr class="my-4">

                                    <!-- RequestDto 설정 -->
                                    <h6 class="text-primary mb-3">
                                        <i class="fas fa-arrow-right"></i> RequestDto 설정
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="requestPackage" class="form-label">RequestDto 패키지</label>
                                            <input type="text" class="form-control" id="requestPackage" name="requestPackage" 
                                                   value="transfer" required>
                                            <div class="form-text">예: transfer</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="requestClassName" class="form-label">RequestDto 클래스명</label>
                                            <input type="text" class="form-control" id="requestClassName" name="requestClassName" 
                                                   placeholder="예: UserRequestDto" required>
                                            <div class="form-text">예: UserRequestDto</div>
                                        </div>
                                    </div>

                                    <!-- ResponseDto 설정 -->
                                    <h6 class="text-success mb-3">
                                        <i class="fas fa-arrow-left"></i> ResponseDto 설정
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="responsePackage" class="form-label">ResponseDto 패키지</label>
                                            <input type="text" class="form-control" id="responsePackage" name="responsePackage" 
                                                   value="transfer" required>
                                            <div class="form-text">예: transfer</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="responseClassName" class="form-label">ResponseDto 클래스명</label>
                                            <input type="text" class="form-control" id="responseClassName" name="responseClassName" 
                                                   placeholder="예: UserResponseDto" required>
                                            <div class="form-text">예: UserResponseDto</div>
                                        </div>
                                    </div>

                                    <!-- DomainDto 설정 -->
                                    <h6 class="text-warning mb-3">
                                        <i class="fas fa-cube"></i> DomainDto 설정
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="domainPackage" class="form-label">DomainDto 패키지</label>
                                            <input type="text" class="form-control" id="domainPackage" name="domainPackage" 
                                                   value="business.dc.dto" required>
                                            <div class="form-text">예: business.dc.dto</div>
                </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="domainClassName" class="form-label">DomainDto 클래스명</label>
                                            <input type="text" class="form-control" id="domainClassName" name="domainClassName" 
                                                   placeholder="예: UserDomainDto" required>
                                            <div class="form-text">예: UserDomainDto</div>
                </div>
            </div>

                                    <hr class="my-4">

                                    <!-- 추가 옵션 -->
                                    <h6 class="text-info mb-3">
                                        <i class="fas fa-cogs"></i> 추가 옵션
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generateController" name="generateController" checked>
                                                <label class="form-check-label" for="generateController">
                                                    Controller 생성
                    </label>
                </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generateService" name="generateService" checked>
                                                <label class="form-check-label" for="generateService">
                                                    Service 생성
                    </label>
                </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generatePC" name="generatePC" checked>
                                                <label class="form-check-label" for="generatePC">
                                                    PC (Presentation Controller) 생성
                    </label>
                </div>
            </div>
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generateDC" name="generateDC" checked>
                                                <label class="form-check-label" for="generateDC">
                                                    DC (Data Controller) 생성
                    </label>
                </div>
                                        </div>
                                    </div>

                                    <!-- Helper 하위 패키지 옵션 -->
                                    <h6 class="text-success mb-3">
                                        <i class="fas fa-tools"></i> Helper 하위 패키지 생성
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generateValidator" name="generateValidator" checked>
                                                <label class="form-check-label" for="generateValidator">
                                                    <i class="fas fa-shield-alt"></i> Validator 생성 (helper/validation)
                    </label>
                                                <div class="form-text">비즈니스 로직 검증을 위한 Validator 클래스</div>
                                            </div>
                </div>
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generateMapper" name="generateMapper" checked>
                                                <label class="form-check-label" for="generateMapper">
                                                    <i class="fas fa-exchange-alt"></i> Mapper 생성 (helper/mapper)
                    </label>
                                                <div class="form-text">DTO ↔ Domain 변환을 위한 Mapper 클래스</div>
                                            </div>
                </div>
                                        <div class="col-md-6 mb-3">
                <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="generateValidationResult" name="generateValidationResult" checked>
                                                <label class="form-check-label" for="generateValidationResult">
                                                    <i class="fas fa-clipboard-check"></i> ValidationResult 생성
                    </label>
                                                <div class="form-text">검증 결과를 담는 공통 클래스</div>
                                            </div>
                </div>
            </div>

                                    <div class="text-center mt-4">
                                        <button type="submit" class="btn btn-gradient btn-lg">
                                            <i class="fas fa-magic"></i> DTO 생성
            </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- 결과 표시 영역 -->
                    <div class="col-lg-4">
                        <div id="resultArea" style="display: none;">
                            <div class="card result-card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-check-circle text-success"></i> 생성 결과
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="resultContent"></div>
                                </div>
                            </div>
        </div>

                        <div id="errorArea" style="display: none;">
                            <div class="card error-card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-exclamation-triangle text-danger"></i> 오류
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="errorContent"></div>
                                </div>
                            </div>
                        </div>
            </div>
            </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('dtoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 폼 데이터 수집
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            // 체크박스 값 처리
            data.generateController = document.getElementById('generateController').checked;
            data.generateService = document.getElementById('generateService').checked;
            data.generatePC = document.getElementById('generatePC').checked;
            data.generateDC = document.getElementById('generateDC').checked;
            data.generateValidator = document.getElementById('generateValidator').checked;
            data.generateMapper = document.getElementById('generateMapper').checked;
            data.generateValidationResult = document.getElementById('generateValidationResult').checked;
            
            // 로딩 표시
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 생성 중...';
            submitBtn.disabled = true;
            
            // API 호출
            fetch('/mbb/workflow/dto/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                if (result.success) {
                    showResult(result);
                } else {
                    showError(result.message || 'DTO 생성 중 오류가 발생했습니다.');
                }
            })
            .catch(error => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                showError('네트워크 오류가 발생했습니다: ' + error.message);
            });
        });

        function showResult(result) {
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('errorArea').style.display = 'none';
            
            let content = '<div class="alert alert-success">';
            content += '<h6><i class="fas fa-check-circle"></i> DTO 생성 완료!</h6>';
            content += '<ul class="list-unstyled mb-0">';
            
            if (result.generatedFiles) {
                result.generatedFiles.forEach(file => {
                    content += `<li><i class="fas fa-file-code"></i> ${file}</li>`;
                });
            }
            
            content += '</ul></div>';
            
            if (result.message) {
                content += `<div class="mt-3"><strong>메시지:</strong> ${result.message}</div>`;
            }
            
            document.getElementById('resultContent').innerHTML = content;
        }

        function showError(message) {
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('errorArea').style.display = 'block';
            document.getElementById('errorContent').innerHTML = `<div class="alert alert-danger">${message}</div>`;
        }

        // 엔티티명 입력 시 자동으로 DTO 클래스명 생성
        document.getElementById('entityName').addEventListener('input', function() {
            const entityName = this.value;
            if (entityName) {
                document.getElementById('requestClassName').value = entityName + 'RequestDto';
                document.getElementById('responseClassName').value = entityName + 'ResponseDto';
                document.getElementById('domainClassName').value = entityName + 'DomainDto';
            }
        });
    </script>
</body>
</html> 