<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">API 테스트 - MBB Java</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <style>
        .api-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .curl-command {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        .copy-btn:hover {
            background-color: #3182ce;
        }
        .test-result {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            color: #007bff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- 네비게이션 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/mbb/">MBB Java</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/">홈</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/api-test">API 테스트</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/mbb/swagger-ui.html">API 문서</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-2">API 테스트 페이지</h1>
                <p class="lead mb-0">PowerShell에서 실행할 수 있는 curl 명령어로 API를 테스트해보세요.</p>
            </div>
            <a href="/mbb/" class="btn btn-outline-primary">
                <i class="fas fa-home"></i> 홈으로
            </a>
        </div>

        <!-- 탭 네비게이션 -->
        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="user-tab" data-bs-toggle="tab" data-bs-target="#user" type="button" role="tab">
                    사용자 관리 API
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="codegen-tab" data-bs-toggle="tab" data-bs-target="#codegen" type="button" role="tab">
                    코드 생성 API
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="status-tab" data-bs-toggle="tab" data-bs-target="#status" type="button" role="tab">
                    상태 확인 API
                </button>
            </li>
        </ul>

        <!-- 탭 콘텐츠 -->
        <div class="tab-content mt-3" id="apiTabContent">
            <!-- 사용자 관리 API -->
            <div class="tab-pane fade show active" id="user" role="tabpanel">
                <div class="api-section">
                    <h3>MBBUSER 테이블 사용자 등록</h3>
                    <p>새로운 사용자를 등록합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('user-register')">복사</button>
                        <pre id="user-register"># PowerShell에서 실행할 때:
$body = @{
    username = "testuser"
    password = "password123"
    email = "test@example.com"
    fullName = "테스트 사용자"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8086/mbb/api/users/register" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body

# 또는 curl.exe 사용 (Windows 10 이상):
curl.exe -X POST "http://localhost:8086/mbb/api/users/register" `
  -H "Content-Type: application/json" `
  -d $body</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('user-register')">테스트 실행</button>
                    <div id="user-register-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>사용자 로그인</h3>
                    <p>사용자 로그인을 수행합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('user-login')">복사</button>
                        <pre id="user-login"># PowerShell에서 실행할 때:
$body = @{
    username = "admin"
    password = "admin123"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8086/mbb/api/users/login" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body

# 또는 curl.exe 사용 (Windows 10 이상):
curl.exe -X POST "http://localhost:8086/mbb/api/users/login" `
  -H "Content-Type: application/json" `
  -d $body</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('user-login')">테스트 실행</button>
                    <div id="user-login-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>사용자 목록 조회</h3>
                    <p>등록된 모든 사용자를 조회합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('user-list')">복사</button>
                        <pre id="user-list">curl -X GET "http://localhost:8086/mbb/api/users" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('user-list')">테스트 실행</button>
                    <div id="user-list-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>사용자 조회</h3>
                    <p>특정 사용자 정보를 조회합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('user-get')">복사</button>
                        <pre id="user-get">curl -X GET "http://localhost:8086/mbb/api/users/1" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('user-get')">테스트 실행</button>
                    <div id="user-get-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>사용자 정보 수정</h3>
                    <p>사용자 정보를 수정합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('user-update')">복사</button>
                        <pre id="user-update"># PowerShell에서 실행할 때:
$body = @{
    username = "updateduser"
    email = "updated@example.com"
    fullName = "수정된 사용자"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8086/mbb/api/users/1" `
  -Method PUT `
  -ContentType "application/json" `
  -Body $body

# 또는 curl.exe 사용 (Windows 10 이상):
curl.exe -X PUT "http://localhost:8086/mbb/api/users/1" `
  -H "Content-Type: application/json" `
  -d $body</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('user-update')">테스트 실행</button>
                    <div id="user-update-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>사용자 삭제</h3>
                    <p>사용자를 삭제합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('user-delete')">복사</button>
                        <pre id="user-delete">curl -X DELETE "http://localhost:8086/mbb/api/users/2" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('user-delete')">테스트 실행</button>
                    <div id="user-delete-result" class="test-result" style="display: none;"></div>
                </div>
            </div>

            <!-- 코드 생성 API -->
            <div class="tab-pane fade" id="codegen" role="tabpanel">
                <div class="api-section">
                    <h3>코드 생성 작업 시작</h3>
                    <p>AI 코딩 워크플로우를 시작합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('codegen-start')">복사</button>
                        <pre id="codegen-start"># PowerShell에서 실행할 때:
$body = @{
    tableDefinition = @{
        tableName = "user"
        columns = @(
            @{
                name = "id"
                type = "BIGINT"
                primaryKey = $true
            },
            @{
                name = "username"
                type = "VARCHAR(50)"
                nullable = $false
            },
            @{
                name = "email"
                type = "VARCHAR(100)"
                nullable = $true
            }
        )
    }
    tasks = @("generate-entity", "generate-repository", "generate-service", "generate-controller")
} | ConvertTo-Json -Depth 10

Invoke-RestMethod -Uri "http://localhost:8086/mbb/api/code-generation/generate" `
  -Method POST `
  -ContentType "application/json" `
  -Body $body

# 또는 curl.exe 사용 (Windows 10 이상):
curl.exe -X POST "http://localhost:8086/mbb/api/code-generation/generate" `
  -H "Content-Type: application/json" `
  -d $body</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('codegen-start')">테스트 실행</button>
                    <div id="codegen-start-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>작업 목록 조회</h3>
                    <p>코드 생성 작업 목록을 조회합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('codegen-list')">복사</button>
                        <pre id="codegen-list">curl -X GET "http://localhost:8086/mbb/api/code-generation/tasks" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('codegen-list')">테스트 실행</button>
                    <div id="codegen-list-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>작업 상태 조회</h3>
                    <p>특정 작업의 상태를 조회합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('codegen-status')">복사</button>
                        <pre id="codegen-status">curl -X GET "http://localhost:8086/mbb/api/code-generation/tasks/1" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('codegen-status')">테스트 실행</button>
                    <div id="codegen-status-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>작업 삭제</h3>
                    <p>코드 생성 작업을 삭제합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('codegen-delete')">복사</button>
                        <pre id="codegen-delete">curl -X DELETE "http://localhost:8086/mbb/api/code-generation/tasks/1" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('codegen-delete')">테스트 실행</button>
                    <div id="codegen-delete-result" class="test-result" style="display: none;"></div>
                </div>
            </div>

            <!-- 상태 확인 API -->
            <div class="tab-pane fade" id="status" role="tabpanel">
                <div class="api-section">
                    <h3>서비스 상태 확인</h3>
                    <p>MBB Java 서비스의 상태를 확인합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('status-check')">복사</button>
                        <pre id="status-check">curl -X GET "http://localhost:8086/mbb/api/status" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('status-check')">테스트 실행</button>
                    <div id="status-check-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>Actuator Health Check</h3>
                    <p>Spring Boot Actuator를 통한 헬스 체크를 수행합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('actuator-health')">복사</button>
                        <pre id="actuator-health">curl -X GET "http://localhost:8086/mbb/actuator/health" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('actuator-health')">테스트 실행</button>
                    <div id="actuator-health-result" class="test-result" style="display: none;"></div>
                </div>

                <div class="api-section">
                    <h3>Actuator Info</h3>
                    <p>애플리케이션 정보를 조회합니다.</p>
                    <div class="curl-command">
                        <button class="copy-btn" onclick="copyToClipboard('actuator-info')">복사</button>
                        <pre id="actuator-info">curl -X GET "http://localhost:8086/mbb/actuator/info" ^
  -H "Content-Type: application/json"</pre>
                    </div>
                    <button class="btn btn-primary" onclick="testApi('actuator-info')">테스트 실행</button>
                    <div id="actuator-info-result" class="test-result" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 클립보드에 복사하는 함수
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                // 복사 성공 시 버튼 텍스트 변경
                const button = element.parentElement.querySelector('.copy-btn');
                const originalText = button.textContent;
                button.textContent = '복사됨!';
                button.style.backgroundColor = '#48bb78';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#4299e1';
                }, 2000);
            }).catch(function(err) {
                console.error('클립보드 복사 실패:', err);
                alert('클립보드 복사에 실패했습니다.');
            });
        }

        // API 테스트 실행 함수
        function testApi(elementId) {
            const resultDiv = document.getElementById(elementId + '-result');
            const curlCommand = document.getElementById(elementId).textContent;
            
            // 결과 영역 표시
            resultDiv.style.display = 'block';
            resultDiv.textContent = '테스트 실행 중...';
            
            // 실제 API 호출을 위한 fetch 요청
            const url = extractUrlFromCurl(curlCommand);
            const method = extractMethodFromCurl(curlCommand);
            const data = extractDataFromCurl(curlCommand);
            
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            if (data) {
                options.body = data;
            }
            
            fetch(url, options)
                .then(response => {
                    const status = response.status;
                    const statusText = response.statusText;
                    
                    return response.text().then(text => {
                        return {
                            status: status,
                            statusText: statusText,
                            body: text
                        };
                    });
                })
                .then(result => {
                    const formattedResult = `HTTP Status: ${result.status} ${result.statusText}
Response Body:
${result.body}`;
                    resultDiv.textContent = formattedResult;
                })
                .catch(error => {
                    resultDiv.textContent = `Error: ${error.message}`;
                });
        }

        // curl 명령어에서 URL 추출
        function extractUrlFromCurl(curlCommand) {
            const urlMatch = curlCommand.match(/curl -X \w+ "([^"]+)"/);
            return urlMatch ? urlMatch[1] : '';
        }

        // curl 명령어에서 HTTP 메서드 추출
        function extractMethodFromCurl(curlCommand) {
            const methodMatch = curlCommand.match(/curl -X (\w+)/);
            return methodMatch ? methodMatch[1] : 'GET';
        }

        // curl 명령어에서 데이터 추출
        function extractDataFromCurl(curlCommand) {
            const dataMatch = curlCommand.match(/-d "([^"]+)"/);
            return dataMatch ? dataMatch[1] : null;
        }
    </script>
</body>
</html> 