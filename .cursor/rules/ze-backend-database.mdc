# Backend Database Guide

## ğŸ—„ï¸ **SKAX EA Tool Eplaton Database Implementation Rules**

### **ğŸ—ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜ ê°œìš”**

```
ğŸ“¦ Database Layer Architecture
â”œâ”€â”€ ğŸ¯ Repository Layer (ë ˆí¬ì§€í† ë¦¬ ë ˆì´ì–´)
â”‚   â”œâ”€â”€ Interface Definition
â”‚   â”œâ”€â”€ Implementation Classes
â”‚   â”œâ”€â”€ Type Safety
â”‚   â””â”€â”€ Error Handling
â”œâ”€â”€ ğŸ”§ Data Access Layer (ë°ì´í„° ì•¡ì„¸ìŠ¤ ë ˆì´ì–´)
â”‚   â”œâ”€â”€ MyBatis Mapper
â”‚   â”œâ”€â”€ JPA Repository
â”‚   â”œâ”€â”€ JDBC Template
â”‚   â””â”€â”€ Connection Pool
â”œâ”€â”€ ğŸ’¾ Entity & DTO Layer (ì—”í‹°í‹° & DTO ë ˆì´ì–´)
â”‚   â”œâ”€â”€ Entity Classes
â”‚   â”œâ”€â”€ DTO Classes
â”‚   â”œâ”€â”€ Type Mapping
â”‚   â””â”€â”€ Validation
â””â”€â”€ ğŸ“Š Database Configuration
    â”œâ”€â”€ Connection Pool
    â”œâ”€â”€ Transaction Management
    â”œâ”€â”€ Query Optimization
    â””â”€â”€ Monitoring & Logging
```

### **ğŸ¯ MUST FOLLOW - ë°ì´í„°ë² ì´ìŠ¤ êµ¬í˜„ ê·œì¹™**

#### **1. Repository íŒ¨í„´ êµ¬í˜„**

**âœ… ì˜¬ë°”ë¥¸ Repository ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡°**
```java
/**
 * ì‚¬ìš©ì ê´€ë¦¬ Repository ì¸í„°í˜ì´ìŠ¤
 * 
 * í”„ë¡œê·¸ë¨ëª…: UserRepository.java
 * ì„¤ëª…: ì‚¬ìš©ì ë°ì´í„° ì ‘ê·¼ì„ ìœ„í•œ Repository ì¸í„°í˜ì´ìŠ¤
 * ì‘ì„±ì¼: 2024-01-01
 * ì‘ì„±ì: SKAX Project Team
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - ì‚¬ìš©ì CRUD ì‘ì—…
 * - ì‚¬ìš©ì ê²€ìƒ‰ ë° ì¡°íšŒ
 * - íƒ€ì… ì•ˆì „ì„± ë³´ì¥
 * 
 * @version 1.0
 */
public interface UserRepository {
    
    /**
     * ì‚¬ìš©ì ì¡°íšŒ
     * 
     * @param userDDTO ì‚¬ìš©ì ì¡°íšŒ ì¡°ê±´
     * @return ì‚¬ìš©ì ì •ë³´
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    User getUser(UserDDTO userDDTO) throws NewBusinessException;
    
    /**
     * ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
     * 
     * @param userDDTO ì‚¬ìš©ì ì¡°íšŒ ì¡°ê±´
     * @return ì‚¬ìš©ì ëª©ë¡
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    List<User> getListUser(UserDDTO userDDTO) throws NewBusinessException;
    
    /**
     * ì‚¬ìš©ì ìƒì„±
     * 
     * @param userDDTO ì‚¬ìš©ì ì •ë³´
     * @return ìƒì„±ëœ í–‰ ìˆ˜
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    int insertUser(UserDDTO userDDTO) throws NewBusinessException;
    
    /**
     * ì‚¬ìš©ì ìˆ˜ì •
     * 
     * @param userDDTO ì‚¬ìš©ì ì •ë³´
     * @return ìˆ˜ì •ëœ í–‰ ìˆ˜
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    int updateUser(UserDDTO userDDTO) throws NewBusinessException;
    
    /**
     * ì‚¬ìš©ì ì‚­ì œ
     * 
     * @param userDDTO ì‚¬ìš©ì ì •ë³´
     * @return ì‚­ì œëœ í–‰ ìˆ˜
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    int deleteUser(UserDDTO userDDTO) throws NewBusinessException;
    
    /**
     * ì‚¬ìš©ì IDë¡œ ì¡°íšŒ
     * 
     * @param userId ì‚¬ìš©ì ID
     * @return ì‚¬ìš©ì ì •ë³´
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    User getUserById(String userId) throws NewBusinessException;
    
    /**
     * ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
     * 
     * @param email ì´ë©”ì¼
     * @return ì‚¬ìš©ì ì •ë³´
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    User getUserByEmail(String email) throws NewBusinessException;
    
    /**
     * ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸
     * 
     * @param userId ì‚¬ìš©ì ID
     * @return ì¡´ì¬ ì—¬ë¶€
     * @throws NewBusinessException ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸
     */
    boolean existsUser(String userId) throws NewBusinessException;
}
```

#### **2. Repository êµ¬í˜„ì²´**

**âœ… MyBatis Repository êµ¬í˜„**
```java
/**
 * ì‚¬ìš©ì ê´€ë¦¬ MyBatis Repository êµ¬í˜„ì²´
 * 
 * í”„ë¡œê·¸ë¨ëª…: UserMyBatisRepository.java
 * ì„¤ëª…: MyBatisë¥¼ ì‚¬ìš©í•œ ì‚¬ìš©ì ê´€ë¦¬ Repository êµ¬í˜„
 * ì‘ì„±ì¼: 2024-01-01
 * ì‘ì„±ì: SKAX Project Team
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
 * - ì‚¬ìš©ì ìƒì„¸ ì¡°íšŒ
 * - ì‚¬ìš©ì ë“±ë¡/ìˆ˜ì •/ì‚­ì œ
 * - í˜ì´ì§• ë° íŠ¸ë¦¬ êµ¬ì¡° ì§€ì›
 * 
 * @version 1.0
 */
@Repository
@Profile("mybatis")
public class UserMyBatisRepository implements UserRepository {
    
    private NewIKesaLogger logger = NewKesaLogHelper.getBiz();
    private static final Logger slf4jLogger = LoggerFactory.getLogger(UserMyBatisRepository.class);
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public List<User> getListUser(UserDDTO userDDTO) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getListUser START ===");
        slf4jLogger.info("=== UserMyBatisRepository.getListUser START (SLF4J) ===");
        
        try {
            logger.debug("UserMyBatisRepository.getListUser called");
            List<User> userList = userMapper.findBySearchCondition(userDDTO);
            
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getListUser END ===");
            slf4jLogger.info("=== UserMyBatisRepository.getListUser END (SLF4J) ===");
            return userList;
            
        } catch (Exception e) {
            logger.error("Error in getListUser: " + e.getMessage(), String.valueOf(e));
            slf4jLogger.error("Error in getListUser: " + e.getMessage(), e);
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getListUser END ===");
            slf4jLogger.info("=== UserMyBatisRepository.getListUser END (SLF4J) ===");
            throw new NewBusinessException("B0000001", "getListUser", e);
        }
    }
    
    @Override
    public int insertUser(UserDDTO userDDTO) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.insertUser START ===");
        
        try {
            int result = userMapper.insertUser(userDDTO);
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.insertUser END ===");
            return result;
            
        } catch (Exception e) {
            logger.error("Error in insertUser: " + e.getMessage(), String.valueOf(e));
            throw new NewBusinessException("B0000002", "insertUser", e);
        }
    }
    
    @Override
    public int updateUser(UserDDTO userDDTO) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.updateUser START ===");
        
        try {
            int result = userMapper.updateUser(userDDTO);
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.updateUser END ===");
            return result;
            
        } catch (Exception e) {
            logger.error("Error in updateUser: " + e.getMessage(), String.valueOf(e));
            throw new NewBusinessException("B0000003", "updateUser", e);
        }
    }
    
    @Override
    public int deleteUser(UserDDTO userDDTO) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.deleteUser START ===");
        
        try {
            int result = userMapper.deleteUser(userDDTO);
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.deleteUser END ===");
            return result;
            
        } catch (Exception e) {
            logger.error("Error in deleteUser: " + e.getMessage(), String.valueOf(e));
            throw new NewBusinessException("B0000004", "deleteUser", e);
        }
    }
    
    @Override
    public User getUserById(String userId) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getUserById START ===");
        
        try {
            User user = userMapper.selectUserById(userId);
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getUserById END ===");
            return user;
            
        } catch (Exception e) {
            logger.error("Error in getUserById: " + e.getMessage(), String.valueOf(e));
            throw new NewBusinessException("B0000005", "getUserById", e);
        }
    }
    
    @Override
    public User getUserByEmail(String email) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getUserByEmail START ===");
        
        try {
            User user = userMapper.selectUserByEmail(email);
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.getUserByEmail END ===");
            return user;
            
        } catch (Exception e) {
            logger.error("Error in getUserByEmail: " + e.getMessage(), String.valueOf(e));
            throw new NewBusinessException("B0000006", "getUserByEmail", e);
        }
    }
    
    @Override
    public boolean existsUser(String userId) throws NewBusinessException {
        logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.existsUser START ===");
        
        try {
            int count = userMapper.countUserById(userId);
            boolean exists = count > 0;
            logger.info("UserMyBatisRepository", "=== UserMyBatisRepository.existsUser END ===");
            return exists;
            
        } catch (Exception e) {
            logger.error("Error in existsUser: " + e.getMessage(), String.valueOf(e));
            throw new NewBusinessException("B0000007", "existsUser", e);
        }
    }
}
```

#### **3. MyBatis Mapper ì¸í„°í˜ì´ìŠ¤**

**âœ… íƒ€ì… ì•ˆì „í•œ Mapper ì¸í„°í˜ì´ìŠ¤**
```java
/**
 * ì‚¬ìš©ì MyBatis Mapper ì¸í„°í˜ì´ìŠ¤
 * 
 * í”„ë¡œê·¸ë¨ëª…: UserMapper.java
 * ì„¤ëª…: ì‚¬ìš©ì ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ìœ„í•œ MyBatis Mapper
 * ì‘ì„±ì¼: 2024-01-01
 * ì‘ì„±ì: SKAX Project Team
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - ì‚¬ìš©ì CRUD SQL ë§¤í•‘
 * - ë™ì  ì¿¼ë¦¬ ì²˜ë¦¬
 * - íƒ€ì… ì•ˆì „ì„± ë³´ì¥
 * 
 * @version 1.0
 */
@Mapper
public interface UserMapper {
    
    /**
     * ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
     * 
     * @param userDDTO ê²€ìƒ‰ ì¡°ê±´
     * @return ì‚¬ìš©ì ëª©ë¡
     */
    List<User> findBySearchCondition(UserDDTO userDDTO);
    
    /**
     * ì‚¬ìš©ì IDë¡œ ì¡°íšŒ
     * 
     * @param userId ì‚¬ìš©ì ID
     * @return ì‚¬ìš©ì ì •ë³´
     */
    User selectUserById(String userId);
    
    /**
     * ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ
     * 
     * @param email ì´ë©”ì¼
     * @return ì‚¬ìš©ì ì •ë³´
     */
    User selectUserByEmail(String email);
    
    /**
     * ì‚¬ìš©ì ë“±ë¡
     * 
     * @param userDDTO ì‚¬ìš©ì ì •ë³´
     * @return ë“±ë¡ëœ í–‰ ìˆ˜
     */
    int insertUser(UserDDTO userDDTO);
    
    /**
     * ì‚¬ìš©ì ìˆ˜ì •
     * 
     * @param userDDTO ì‚¬ìš©ì ì •ë³´
     * @return ìˆ˜ì •ëœ í–‰ ìˆ˜
     */
    int updateUser(UserDDTO userDDTO);
    
    /**
     * ì‚¬ìš©ì ì‚­ì œ
     * 
     * @param userDDTO ì‚¬ìš©ì ì •ë³´
     * @return ì‚­ì œëœ í–‰ ìˆ˜
     */
    int deleteUser(UserDDTO userDDTO);
    
    /**
     * ì‚¬ìš©ì ID ì¡´ì¬ ì—¬ë¶€ í™•ì¸
     * 
     * @param userId ì‚¬ìš©ì ID
     * @return ì¡´ì¬í•˜ëŠ” í–‰ ìˆ˜
     */
    int countUserById(String userId);
    
    /**
     * ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
     * 
     * @param email ì´ë©”ì¼
     * @return ì¡´ì¬í•˜ëŠ” í–‰ ìˆ˜
     */
    int countUserByEmail(String email);
    
    /**
     * í˜ì´ì§•ì„ ìœ„í•œ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
     * 
     * @param userDDTO ê²€ìƒ‰ ì¡°ê±´
     * @return ì‚¬ìš©ì ëª©ë¡
     */
    List<User> selectUserListWithPaging(UserDDTO userDDTO);
    
    /**
     * ì‚¬ìš©ì ì´ ê°œìˆ˜ ì¡°íšŒ
     * 
     * @param userDDTO ê²€ìƒ‰ ì¡°ê±´
     * @return ì´ ê°œìˆ˜
     */
    int selectUserCount(UserDDTO userDDTO);
}
```

#### **4. MyBatis XML Mapper**

**âœ… íƒ€ì… ì•ˆì „í•œ XML Mapper**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.skax.eatool.mbc.dc.usermgtdc.mapper.UserMapper">

    <!-- ê²°ê³¼ ë§µ ì •ì˜ -->
    <resultMap id="UserResultMap" type="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDto">
        <id column="USER_ID" property="userId" jdbcType="VARCHAR"/>
        <result column="USER_NAME" property="userName" jdbcType="VARCHAR"/>
        <result column="EMAIL" property="email" jdbcType="VARCHAR"/>
        <result column="PHONE" property="phone" jdbcType="VARCHAR"/>
        <result column="ROLE" property="role" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="CREATED_DATE" property="createdDate" jdbcType="TIMESTAMP"/>
        <result column="UPDATED_DATE" property="updatedDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ -->
    <select id="selectUserList" resultMap="UserResultMap" parameterType="com.skax.eatool.mbc.dc.usermgtdc.Page">
        SELECT 
            USER_ID,
            USER_NAME,
            EMAIL,
            PHONE,
            ROLE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM USER_INFO
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (USER_NAME LIKE CONCAT('%', #{searchKeyword}, '%')
                OR EMAIL LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="role != null and role != ''">
                AND ROLE = #{role}
            </if>
            <if test="status != null and status != ''">
                AND STATUS = #{status}
            </if>
        </where>
        ORDER BY CREATED_DATE DESC
        <if test="pageSize > 0">
            LIMIT #{pageSize} OFFSET #{offset}
        </if>
    </select>

    <!-- ì‚¬ìš©ì ì´ ê°œìˆ˜ ì¡°íšŒ -->
    <select id="selectUserCount" resultType="int" parameterType="com.skax.eatool.mbc.dc.usermgtdc.Page">
        SELECT COUNT(*)
        FROM USER_INFO
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (USER_NAME LIKE CONCAT('%', #{searchKeyword}, '%')
                OR EMAIL LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="role != null and role != ''">
                AND ROLE = #{role}
            </if>
            <if test="status != null and status != ''">
                AND STATUS = #{status}
            </if>
        </where>
    </select>

    <!-- ì‚¬ìš©ì IDë¡œ ì¡°íšŒ -->
    <select id="selectUserById" parameterType="string" resultMap="UserResultMap">
        SELECT 
            USER_ID,
            USER_NAME,
            EMAIL,
            PHONE,
            ROLE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM USER_INFO
        WHERE USER_ID = #{userId}
    </select>

    <!-- ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ -->
    <select id="selectUserByEmail" parameterType="string" resultMap="UserResultMap">
        SELECT 
            USER_ID,
            USER_NAME,
            EMAIL,
            PHONE,
            ROLE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM USER_INFO
        WHERE EMAIL = #{email}
    </select>

    <!-- ì‚¬ìš©ì ë“±ë¡ -->
    <insert id="insertUser" parameterType="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDDTO">
        INSERT INTO USER_INFO (
            USER_ID,
            USER_NAME,
            EMAIL,
            PHONE,
            ROLE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        ) VALUES (
            #{userId},
            #{userName},
            #{email},
            #{phone},
            #{role},
            #{status},
            NOW(),
            NOW()
        )
    </insert>

    <!-- ì‚¬ìš©ì ìˆ˜ì • -->
    <update id="updateUser" parameterType="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDDTO">
        UPDATE USER_INFO
        SET 
            USER_NAME = #{userName},
            EMAIL = #{email},
            PHONE = #{phone},
            ROLE = #{role},
            STATUS = #{status},
            UPDATED_DATE = NOW()
        WHERE USER_ID = #{userId}
    </update>

    <!-- ì‚¬ìš©ì ì‚­ì œ -->
    <delete id="deleteUser" parameterType="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDDTO">
        DELETE FROM USER_INFO
        WHERE USER_ID = #{userId}
    </delete>

    <!-- ì‚¬ìš©ì ID ì¡´ì¬ ì—¬ë¶€ í™•ì¸ -->
    <select id="countUserById" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM USER_INFO
        WHERE USER_ID = #{userId}
    </select>

    <!-- ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ -->
    <select id="countUserByEmail" parameterType="string" resultType="int">
        SELECT COUNT(*)
        FROM USER_INFO
        WHERE EMAIL = #{email}
    </select>

    <!-- ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ -->
    <select id="findBySearchCondition" parameterType="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDDTO" resultMap="UserResultMap">
        SELECT 
            USER_ID,
            USER_NAME,
            EMAIL,
            PHONE,
            ROLE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM USER_INFO
        <where>
            <if test="userId != null and userId != ''">
                AND USER_ID = #{userId}
            </if>
            <if test="userName != null and userName != ''">
                AND USER_NAME LIKE CONCAT('%', #{userName}, '%')
            </if>
            <if test="email != null and email != ''">
                AND EMAIL = #{email}
            </if>
            <if test="role != null and role != ''">
                AND ROLE = #{role}
            </if>
            <if test="status != null and status != ''">
                AND STATUS = #{status}
            </if>
        </where>
        ORDER BY CREATED_DATE DESC
    </select>

    <!-- í˜ì´ì§•ì„ ìœ„í•œ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ -->
    <select id="selectUserListWithPaging" parameterType="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDDTO" resultMap="UserResultMap">
        SELECT 
            USER_ID,
            USER_NAME,
            EMAIL,
            PHONE,
            ROLE,
            STATUS,
            CREATED_DATE,
            UPDATED_DATE
        FROM USER_INFO
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (USER_NAME LIKE CONCAT('%', #{searchKeyword}, '%')
                OR EMAIL LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="role != null and role != ''">
                AND ROLE = #{role}
            </if>
            <if test="status != null and status != ''">
                AND STATUS = #{status}
            </if>
        </where>
        ORDER BY CREATED_DATE DESC
        <if test="startRow != null and endRow != null">
            LIMIT #{endRow} OFFSET #{startRow}
        </if>
    </select>

    <!-- ì‚¬ìš©ì ì´ ê°œìˆ˜ ì¡°íšŒ (ê²€ìƒ‰ ì¡°ê±´ í¬í•¨) -->
    <select id="selectUserCount" parameterType="com.skax.eatool.mbc.dc.usermgtdc.dto.UserDDTO" resultType="int">
        SELECT COUNT(*)
        FROM USER_INFO
        <where>
            <if test="searchKeyword != null and searchKeyword != ''">
                AND (USER_NAME LIKE CONCAT('%', #{searchKeyword}, '%')
                OR EMAIL LIKE CONCAT('%', #{searchKeyword}, '%'))
            </if>
            <if test="role != null and role != ''">
                AND ROLE = #{role}
            </if>
            <if test="status != null and status != ''">
                AND STATUS = #{status}
            </if>
        </where>
    </select>

</mapper>
```

#### **5. Entity ë° DTO í´ë˜ìŠ¤**

**âœ… íƒ€ì… ì•ˆì „í•œ Entity í´ë˜ìŠ¤**
```java
/**
 * ì‚¬ìš©ì ì—”í‹°í‹° í´ë˜ìŠ¤
 * 
 * í”„ë¡œê·¸ë¨ëª…: User.java
 * ì„¤ëª…: ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤
 * ì‘ì„±ì¼: 2024-01-01
 * ì‘ì„±ì: SKAX Project Team
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ ê´€ë¦¬
 * - JDBC Template ë§¤í•‘
 * - íƒ€ì… ì•ˆì „ì„± ë³´ì¥
 * 
 * @version 1.0
 */
public class User extends BaseEntity {

    private Long userId;
    private String userName;
    private String email;
    private String phone;
    private UserStatus status = UserStatus.ACTIVE;
    private LocalDateTime lastLoginDate;

    // ê¸°ë³¸ ìƒì„±ì
    public User() {}

    // ìƒì„±ì
    public User(String userName, String email, String phone) {
        this.userName = userName;
        this.email = email;
        this.phone = phone;
        this.status = UserStatus.ACTIVE;
    }

    // Getters and Setters
    public Long getUserId() {
        return userId;
    }

    public void setUserId(Long userId) {
        this.userId = userId;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public UserStatus getStatus() {
        return status;
    }

    public void setStatus(UserStatus status) {
        this.status = status;
    }

    public LocalDateTime getLastLoginDate() {
        return lastLoginDate;
    }

    public void setLastLoginDate(LocalDateTime lastLoginDate) {
        this.lastLoginDate = lastLoginDate;
    }

    /**
     * ì‚¬ìš©ì ìƒíƒœ ì—´ê±°í˜•
     */
    public enum UserStatus {
        ACTIVE, INACTIVE, SUSPENDED, DELETED
    }

    @Override
    public String toString() {
        return "User{" +
                "userId=" + userId +
                ", userName='" + userName + '\'' +
                ", email='" + email + '\'' +
                ", phone='" + phone + '\'' +
                ", status=" + status +
                ", lastLoginDate=" + lastLoginDate +
                '}';
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return Objects.equals(userId, user.userId) &&
                Objects.equals(email, user.email);
    }

    @Override
    public int hashCode() {
        return Objects.hash(userId, email);
    }
}
```

**âœ… íƒ€ì… ì•ˆì „í•œ DTO í´ë˜ìŠ¤**
```java
/**
 * ì‚¬ìš©ì DTO í´ë˜ìŠ¤
 * 
 * í”„ë¡œê·¸ë¨ëª…: UserDDTO.java
 * ì„¤ëª…: ì‚¬ìš©ì ë°ì´í„° ì „ì†¡ì„ ìœ„í•œ DTO í´ë˜ìŠ¤
 * ì‘ì„±ì¼: 2024-01-01
 * ì‘ì„±ì: SKAX Project Team
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - ì‚¬ìš©ì ë°ì´í„° ì „ì†¡
 * - íƒ€ì… ì•ˆì „ì„± ë³´ì¥
 * - ê²€ì¦ ë¡œì§ í¬í•¨
 * 
 * @version 1.0
 */
public class UserDDTO extends NewAbstractDTO {

    private String userId;
    private String userName;
    private String email;
    private String phone;
    private String role;
    private String status;
    private String searchKeyword;
    private Integer startRow;
    private Integer endRow;
    private Integer pageSize;
    private Integer offset;

    // ê¸°ë³¸ ìƒì„±ì
    public UserDDTO() {}

    // ìƒì„±ì
    public UserDDTO(String userId, String userName, String email) {
        this.userId = userId;
        this.userName = userName;
        this.email = email;
    }

    // Getters and Setters
    public String getUserId() {
        return userId;
    }

    public void setUserId(String userId) {
        this.userId = userId;
    }

    public String getUserName() {
        return userName;
    }

    public void setUserName(String userName) {
        this.userName = userName;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getPhone() {
        return phone;
    }

    public void setPhone(String phone) {
        this.phone = phone;
    }

    public String getRole() {
        return role;
    }

    public void setRole(String role) {
        this.role = role;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public String getSearchKeyword() {
        return searchKeyword;
    }

    public void setSearchKeyword(String searchKeyword) {
        this.searchKeyword = searchKeyword;
    }

    public Integer getStartRow() {
        return startRow;
    }

    public void setStartRow(Integer startRow) {
        this.startRow = startRow;
    }

    public Integer getEndRow() {
        return endRow;
    }

    public void setEndRow(Integer endRow) {
        this.endRow = endRow;
    }

    public Integer getPageSize() {
        return pageSize;
    }

    public void setPageSize(Integer pageSize) {
        this.pageSize = pageSize;
    }

    public Integer getOffset() {
        return offset;
    }

    public void setOffset(Integer offset) {
        this.offset = offset;
    }

    /**
     * í˜ì´ì§• ì •ë³´ ì„¤ì •
     */
    public void setPaging(int page, int pageSize) {
        this.pageSize = pageSize;
        this.offset = (page - 1) * pageSize;
        this.startRow = this.offset;
        this.endRow = this.offset + pageSize;
    }

    /**
     * ê²€ì¦ ë©”ì„œë“œ
     */
    public boolean isValid() {
        return userId != null && !userId.trim().isEmpty() &&
               userName != null && !userName.trim().isEmpty() &&
               email != null && !email.trim().isEmpty();
    }

    @Override
    public String toString() {
        return "UserDDTO{" +
                "userId='" + userId + '\'' +
                ", userName='" + userName + '\'' +
                ", email='" + email + '\'' +
                ", phone='" + phone + '\'' +
                ", role='" + role + '\'' +
                ", status='" + status + '\'' +
                ", searchKeyword='" + searchKeyword + '\'' +
                ", startRow=" + startRow +
                ", endRow=" + endRow +
                ", pageSize=" + pageSize +
                ", offset=" + offset +
                '}';
    }
}
```

#### **6. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •**

**âœ… MyBatis ì„¤ì •**
```java
/**
 * MyBatis ì„¤ì • í´ë˜ìŠ¤
 * 
 * í”„ë¡œê·¸ë¨ëª…: MyBatisConfig.java
 * ì„¤ëª…: MyBatis ê´€ë ¨ ì„¤ì •ì„ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤
 * ì‘ì„±ì¼: 2024-01-01
 * ì‘ì„±ì: SKAX Project Team
 * 
 * ì£¼ìš” ê¸°ëŠ¥:
 * - SqlSessionFactory ì„¤ì •
 * - Mapper ìŠ¤ìº” ì„¤ì •
 * - íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ì„¤ì •
 * 
 * @version 1.0
 */
@Configuration
@Profile({ "mybatis", "default" })
@MapperScan(basePackages = "com.skax.eatool.mbc.dc.usermgtdc.mapper")
public class MyBatisConfig {

    /**
     * SqlSessionFactory ì„¤ì •
     * 
     * @param dataSource ë°ì´í„°ì†ŒìŠ¤
     * @return SqlSessionFactory
     * @throws Exception ì„¤ì • ì˜¤ë¥˜
     */
    @Bean
    public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {
        SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();
        sessionFactory.setDataSource(dataSource);

        // Mapper XML íŒŒì¼ ìœ„ì¹˜ ì„¤ì •
        sessionFactory.setMapperLocations(
                new PathMatchingResourcePatternResolver().getResources("classpath:mapper/*.xml"));

        // MyBatis ì„¤ì •
        org.apache.ibatis.session.Configuration configuration = new org.apache.ibatis.session.Configuration();
        configuration.setMapUnderscoreToCamelCase(true);
        configuration.setLogImpl(org.apache.ibatis.logging.stdout.StdOutImpl.class);
        sessionFactory.setConfiguration(configuration);

        return sessionFactory.getObject();
    }

    /**
     * íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € ì„¤ì •
     * 
     * @param dataSource ë°ì´í„°ì†ŒìŠ¤
     * @return PlatformTransactionManager
     */
    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}
```

### **ğŸš« NEVER DO - ë°ì´í„°ë² ì´ìŠ¤ êµ¬í˜„ ìœ„ë°˜ì‚¬í•­**

#### **1. ì˜ëª»ëœ Repository íŒ¨í„´**
```java
// âŒ ì˜ëª»ëœ ì˜ˆì‹œ
@Service
public class UserService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public User getUser(String userId) {
        String sql = "SELECT * FROM users WHERE user_id = ?";
        return jdbcTemplate.queryForObject(sql, new Object[]{userId}, User.class);
    }
}

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
@Service
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    public User getUser(String userId) throws NewBusinessException {
        return userRepository.getUserById(userId);
    }
}
```

#### **2. ì˜ëª»ëœ íƒ€ì… ì•ˆì „ì„±**
```java
// âŒ ì˜ëª»ëœ ì˜ˆì‹œ
public class UserRepository {
    
    public List<Map<String, Object>> getUsers() {
        // Map ì‚¬ìš©ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± ì—†ìŒ
        return jdbcTemplate.queryForList("SELECT * FROM users");
    }
}

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
public class UserRepository {
    
    public List<User> getUsers() throws NewBusinessException {
        // ê°•íƒ€ì… ì‚¬ìš©ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„± ë³´ì¥
        return userMapper.selectAllUsers();
    }
}
```

#### **3. ì˜ëª»ëœ SQL ì¿¼ë¦¬**
```java
// âŒ ì˜ëª»ëœ ì˜ˆì‹œ
public class UserRepository {
    
    public void insertUser(String userId, String userName) {
        String sql = "INSERT INTO users VALUES ('" + userId + "', '" + userName + "')";
        // SQL Injection ìœ„í—˜
        jdbcTemplate.execute(sql);
    }
}

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
public class UserRepository {
    
    public int insertUser(UserDDTO userDDTO) throws NewBusinessException {
        return userMapper.insertUser(userDDTO);
    }
}
```

### **ğŸ“‹ ë°ì´í„°ë² ì´ìŠ¤ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### **ìƒˆë¡œìš´ Repository ìƒì„± ì‹œ**
- [ ] Repository ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- [ ] Repository êµ¬í˜„ì²´ ìƒì„±
- [ ] Mapper ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- [ ] XML Mapper íŒŒì¼ ìƒì„±
- [ ] Entity í´ë˜ìŠ¤ ì •ì˜
- [ ] DTO í´ë˜ìŠ¤ ì •ì˜

#### **íƒ€ì… ì•ˆì „ì„± ê·œì¹™**
- [ ] ê°•íƒ€ì… ì‚¬ìš© (Map ëŒ€ì‹  Entity/DTO)
- [ ] ì œë„¤ë¦­ íƒ€ì… í™œìš©
- [ ] null ì²´í¬ êµ¬í˜„
- [ ] ì˜ˆì™¸ ì²˜ë¦¬ êµ¬í˜„

#### **SQL ì¿¼ë¦¬ ê·œì¹™**
- [ ] PreparedStatement ì‚¬ìš©
- [ ] SQL Injection ë°©ì§€
- [ ] ë™ì  ì¿¼ë¦¬ í™œìš©
- [ ] í˜ì´ì§• ì²˜ë¦¬ êµ¬í˜„

#### **ì„±ëŠ¥ ìµœì í™”**
- [ ] ì¸ë±ìŠ¤ í™œìš©
- [ ] ì¿¼ë¦¬ ìµœì í™”
- [ ] ì»¤ë„¥ì…˜ í’€ ì„¤ì •
- [ ] ìºì‹± ì „ëµ ìˆ˜ë¦½

### **ğŸ”§ íŠ¹ë³„í•œ ë°ì´í„°ë² ì´ìŠ¤ íŒ¨í„´**

#### **1. í˜ì´ì§• ì²˜ë¦¬**
```java
/**
 * í˜ì´ì§• ê²°ê³¼ DTO
 */
public class PagingResult<T> {
    private List<T> data;
    private int totalCount;
    private int currentPage;
    private int pageSize;
    private int totalPages;
    
    public PagingResult(List<T> data, int totalCount, int currentPage, int pageSize) {
        this.data = data;
        this.totalCount = totalCount;
        this.currentPage = currentPage;
        this.pageSize = pageSize;
        this.totalPages = (int) Math.ceil((double) totalCount / pageSize);
    }
    
    // Getters and Setters
    public List<T> getData() {
        return data;
    }
    
    public void setData(List<T> data) {
        this.data = data;
    }
    
    public int getTotalCount() {
        return totalCount;
    }
    
    public void setTotalCount(int totalCount) {
        this.totalCount = totalCount;
    }
    
    public int getCurrentPage() {
        return currentPage;
    }
    
    public void setCurrentPage(int currentPage) {
        this.currentPage = currentPage;
    }
    
    public int getPageSize() {
        return pageSize;
    }
    
    public void setPageSize(int pageSize) {
        this.pageSize = pageSize;
    }
    
    public int getTotalPages() {
        return totalPages;
    }
    
    public void setTotalPages(int totalPages) {
        this.totalPages = totalPages;
    }
}
```

#### **2. íŠ¸ëœì­ì…˜ ê´€ë¦¬**
```java
@Service
@Transactional
public class UserService {
    
    @Autowired
    private UserRepository userRepository;
    
    /**
     * ì‚¬ìš©ì ë“±ë¡ (íŠ¸ëœì­ì…˜ í¬í•¨)
     */
    @Transactional(rollbackFor = {NewBusinessException.class})
    public UserDto createUser(UserDDTO userDDTO) throws NewBusinessException {
        try {
            // 1. ì‚¬ìš©ì ê²€ì¦
            validateUser(userDDTO);
            
            // 2. ì¤‘ë³µ ì²´í¬
            if (userRepository.existsUser(userDDTO.getUserId())) {
                throw new NewBusinessException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.");
            }
            
            // 3. ì‚¬ìš©ì ë“±ë¡
            int result = userRepository.insertUser(userDDTO);
            
            if (result > 0) {
                return UserDto.from(userRepository.getUserById(userDDTO.getUserId()));
            } else {
                throw new NewBusinessException("ì‚¬ìš©ì ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
            
        } catch (NewBusinessException e) {
            throw e;
        } catch (Exception e) {
            throw new NewBusinessException("ì‚¬ìš©ì ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", e);
        }
    }
}
```

#### **3. ë°°ì¹˜ ì²˜ë¦¬**
```java
@Service
@Transactional
public class BatchUserService {
    
    @Autowired
    private UserRepository userRepository;
    
    /**
     * ë°°ì¹˜ ì‚¬ìš©ì ë“±ë¡
     */
    @Transactional(rollbackFor = {NewBusinessException.class})
    public BatchResult createUsersBatch(List<UserDDTO> userDDTOs) throws NewBusinessException {
        BatchResult result = new BatchResult();
        
        for (UserDDTO userDDTO : userDDTOs) {
            try {
                userRepository.insertUser(userDDTO);
                result.addSuccess(userDDTO.getUserId());
            } catch (Exception e) {
                result.addFailure(userDDTO.getUserId(), e.getMessage());
            }
        }
        
        return result;
    }
}
```

### **âš ï¸ ì£¼ì˜ì‚¬í•­**

1. **íƒ€ì… ì•ˆì „ì„±**: Map ëŒ€ì‹  ê°•íƒ€ì… Entity/DTO ì‚¬ìš©
2. **SQL Injection ë°©ì§€**: PreparedStatement ì‚¬ìš©
3. **íŠ¸ëœì­ì…˜ ê´€ë¦¬**: ì ì ˆí•œ íŠ¸ëœì­ì…˜ ê²½ê³„ ì„¤ì •
4. **ì„±ëŠ¥ ìµœì í™”**: ì¸ë±ìŠ¤ í™œìš© ë° ì¿¼ë¦¬ ìµœì í™”
5. **ì—ëŸ¬ ì²˜ë¦¬**: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì—ì„œ ì˜ˆì™¸ ì²˜ë¦¬

ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ ë°ì´í„°ë² ì´ìŠ¤ êµ¬í˜„ì„ í•˜ë©´ íƒ€ì… ì•ˆì „í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
## ë°ì´í„°ë² ì´ìŠ¤ í‘œì¤€
1. í…Œì´ë¸”/ì»¬ë ‰ì…˜ ì„¤ê³„ì›ì¹™
    - ëª…ëª…ê·œì¹™
        - í…Œì´ë¸”/ì»¬ë ‰ì…˜
        - ì»¬ëŸ¼/í•„ë“œ
        - ê¸°ë³¸í‚¤
        - ì™¸ë˜í‚¤
    - ì •ê·œí™”/ë¹„ì •ê·œí™”
    - ë°ì´í„° íƒ€ì…
    - íƒ€ì…ìŠ¤íƒ¬í”„
    ì—¬ê¸°ì— ëŒ€í•œ ê·œì¹™ì„ ì •í•´ì¤˜
2. ì¿¼ë¦¬ ì‘ì„± ì›ì¹™
    - SELECT
    - JOIN
    - WHERE
    - ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬
    ì´ ê·œì¹™ì— ëŒ€í•œ ì •ë¦¬ë¥¼ ë¶€íƒí•´
3. ì¸ë±ì‹± ì „ëµ
    ì´ ì „ëµì— ëŒ€í•´ì„œ ë¶€íƒí•´
4. ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜
    ì–´ë–¤ ì§„í–‰í•´ì•¼ ë˜ëŠ” ì›ì¹™ì„ ì •í•´ì¤˜
5. ë°ì´í„°ë² ì´ìŠ¤ ê¸°ìˆ ë³„ ìƒì…° ê°€ì´ë“œ
    - ìŠ¤í‚¤ë§ˆ êµ¬ì¡° í‘œì¤€
6. ì¸ë±ìŠ¤ ì „ëµ ë° ì„±ëŠ¥ ìµœì í™”
    - ì¸ì²µìŠ¤ ì„¤ê³„ì›ì¹™
    - ì¿¼ë¦¬ ìµœì í™” íŒ¨í„´ 
7. ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ì‹œë“œ ë°ì´í„°
8. ë°±ì—… ë° ë³µêµ¬ ì „ëµ
9. ëª¨ë‹ˆí„°ë§ ë° ë°±ì—… ì‹¤í–‰

1-9ê¹Œì§€ì˜ ë£°ì„ ì •í•´ì¤˜
---
